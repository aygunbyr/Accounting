# Code Review Findings

## Payment command handling
- **Weak UTC parsing for creation**: `CreatePaymentHandler` uses `DateTimeStyles.AdjustToUniversal` without assuming UTC, so unspecified dates are interpreted in the server's local timezone before being shifted. A client sending `2025-01-01T10:00:00` on a server running in UTC+3 will be stored as `07:00` UTC. Invalid formats also bubble up as `ArgumentException`, which the middleware converts into a 500 instead of a 400/422 validation error. 【F:Accounting.Application/Payments/Commands/Create/CreatePaymentHandler.cs†L14-L40】
- **Row version parsing asymmetry on delete**: `SoftDeletePaymentHandler` calls `Convert.FromBase64String` directly. A malformed `rowVersion` produces a `FormatException` and results in a 500 response instead of a domain-specific 409 like the update path. 【F:Accounting.Application/Payments/Commands/Delete/SoftDeletePaymentHandler.cs†L12-L32】
- **Currency normalization inconsistent across commands**: Updates force currency codes to uppercase while creates persist the raw value. This allows mixed-case currency data (e.g., `"usd"` on create vs `"USD"` on update), which can break equality filters in case-sensitive collations and complicate data analysis. 【F:Accounting.Application/Payments/Commands/Create/CreatePaymentHandler.cs†L21-L40】【F:Accounting.Application/Payments/Commands/Update/UpdatePaymentHandler.cs†L29-L72】
